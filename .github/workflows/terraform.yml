name: learn-github-actions
run-name: ${{ github.actor }} is learning GitHub Actions
on: [push]

jobs:
  build:

    runs-on: ubuntu-latest
    permissions:
        contents: read
        id-token: write
    steps:
      - name: Set JWT Auth Token
        id: auth-token
        run: |
            export TOKEN=$(curl -sSL -H "Authorization: bearer $ACTIONS_ID_TOKEN_REQUEST_TOKEN" "$ACTIONS_ID_TOKEN_REQUEST_URL")
            echo $TOKEN | jq .value | base64
            echo "token=$(echo $TOKEN)" >> $GITHUB_OUTPUT
            echo "token=$(echo $ACTIONS_ID_TOKEN_REQUEST_TOKEN)" >> $GITHUB_OUTPUT
            echo "token=$(echo $ACTIONS_ID_TOKEN_REQUEST_URL)" >> $GITHUB_OUTPUT
      - name: Login to Vault
        uses: hashicorp/vault-action@v2
        with:
          url: https://vault.magserver.com
          role: myproject-staging
          method: jwt
          jwtGithubAudience: sigstore # set the GitHub token's aud claim
          # method: github
          # githubToken: ${{ secrets.TOKEN || github.token }}
